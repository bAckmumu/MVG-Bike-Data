<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="p/favicon.ico">
  <title>MVG Bike Projekt</title>
  <!-- Bootstrap core CSS -->
  <link href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet">
  <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
  <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
  <script src="js/ie-emulation-modes-warning.js"></script>
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
 <!--    D3 Head Map -->
<!--     <script src="https://d3js.org/d3.v4.min.js"></script>
    <script type="js/munichHeadMap.js"></script> -->
</head>
<body>
  <div class="header clearfix">
    <nav>
      <ul class="nav nav-pills pull-right">
        <li>
          <button type="button" class="btn btn-default btn-lg" aria-label="Align Justify">
            <span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span>
          </button>
        </li>
      </ul>
    </nav>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-lg-6">
        <div class="jumbotron">
          <img class="img-thumbnail" src="p/pBike.png">
        </div>
      </div>
      <div class="col-lg-6">
        <h3>Radlquatier München</h3>
        <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo,</p>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <div> <svg></svg></div>
        <div>
          <h4>Münchner Stadteile</h4>
          <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus. Aenean leo ligula, porttitor eu, consequat vitae, </p>
        </div>
      </div>
    </div>
  </div>
  <!-- /container -->
  <div class="col-lg-12">
  <div class="jumbotron">
  </div>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-lg-6 ">
        <a class="btn btn-card" href="daten.html" role="button"> <img class="img-thumbnail" src="p/pBike.png">
          <h3>Das MVG Rad in Daten</h3></a>
      </div>
      <div class="col-lg-6">
        <a class="btn btn-card" href="abstellradar.html" role="button"> <img class="img-thumbnail" src="p/pBike.png">
          <h3>Das Abstellradar</h3></a>
      </div>
    </div>
  </div>
  </div>
  </div>
  <footer class="footer">
    <ol class="breadcrumb">
      <li><a href="#">Home</a></li>
      <li><a href="#">über das Projekt</a></li>
      <li><a href="#">Abstellradar</a></li>
      <li><a href="#">MVG</a></li>
      <!-- <li class="active">Data</li> -->
    </ol>
    <p>&copy; 2016 Company, Inc.</p>
  </footer>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="js/ie10-viewport-bug-workaround.js"></script>
  <svg></svg>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
    var width = 900,
        height = 600,
        centered,
        districts;

    // Define color scale
    var color = d3.scaleLinear()
        .domain([0, 6000])
        .clamp(true)
        .range(['#fff', '#409A99']);

    // var color = d3.scaleSequential(d3.interpolateWarm)
    // .domain([6000, 0]);

    var projection = d3.geoMercator()
        .scale(120000)
        // Center the Map in Munich
        .center([11.55, 48.15])
        // .center([11.581980599999952, 48.1351253])
        .translate([width / 2, height / 2]);

    var path = d3.geoPath()
        .projection(projection);

    // Set svg width & height
    var svg = d3.select('svg')
        .attr('width', width)
        .attr('height', height);

    // Add background
    svg.append('rect')
        .attr('class', 'background')
        .attr('width', width)
        .attr('height', height)
        .on('click', clicked);

    var g = svg.append('g');

    var effectLayer = g.append('g')
        .classed('effect-layer', true);

    var mapLayer = g.append('g')
        .classed('map-layer', true);

    var dummyText = g.append('text')
        .classed('dummy-text', true)
        .attr('x', 10)
        .attr('y', 30)
        .style('opacity', 0);

    var bigText = g.append('text')
        .classed('big-text', true)
        .attr('x', 20)
        .attr('y', 45);

    // Load halts data
    d3.json('data/district.json', function(error, districtData) {
        districts = districtData.districts;
    });

    // Load map data
    d3.json('data/munich.geojson', function(error, mapData) {
        var features = mapData.features;

        // Update color scale domain based on data
        // color.domain([d3.max(features, nameLength), 0]);
        color.domain([0, d3.max(features, nameLength)]);

        // Draw each province as a path
        mapLayer.selectAll('path')
            .data(features)
            .enter().append('path')
            .attr('d', path)
            .attr('vector-effect', 'non-scaling-stroke')
            .style('fill', fillFn)
            .on('mouseover', mouseover)
            .on('mouseout', mouseout)
            .on('click', clicked);
    });

    // Get province name
    function nameFn(d) {
        return d && d.properties ? d.properties.name : null;
    }

    // Get province name length
    function getDistrict(d) {
        var n = nameFn(d);
        
        var index = districts.findIndex(function (district) {
          return district.name === n;
        });

        return districts[index];
    }

    // Todo rename getTotalCount
    function nameLength(d) {
      return getDistrict(d).monthlyAverage;
    }

    // Get province color
    function fillFn(d) {
        return color(nameLength(d));
    }

    // When clicked, zoom in
    function clicked(d) {
        var x, y, k;

        // Compute centroid of the selected path
        if (d && centered !== d) {
            var centroid = path.centroid(d);
            x = centroid[0];
            y = centroid[1];
            k = 4;
            centered = d;
        } else {
            x = width / 2;
            y = height / 2;
            k = 1;
            centered = null;
        }

        // Highlight the clicked province
        mapLayer.selectAll('path')
            .style('fill', function(d) {
                return centered && d === centered ? '#D5708B' : fillFn(d);
            });

        // Zoom
        g.transition()
            .duration(750)
            .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')scale(' + k + ')translate(' + -x + ',' + -y + ')');
    }

    function mouseover(d) {
        // Highlight hovered province
        d3.select(this).style('fill', 'orange');

        // Draw effects
        textArt(getDistrict(d));
    }

    function mouseout(d) {
        // Reset province color
        mapLayer.selectAll('path')
            .style('fill', function(d) {
                return centered && d === centered ? '#D5708B' : fillFn(d);
            });

        // Remove effect text
        effectLayer.selectAll('text').transition()
            .style('opacity', 0)
            .remove();

        // Clear province name
        bigText.text('');
    }

    // Gimmick
    // Just me playing around.
    // You won't need this for a regular map.

    function textArt(district) {
        bigText
        // .style('font-family', fontFamily)
            .text(district.name + ': sum ' + district.totalCount + ' monthly average ' + district.monthlyAverage);

    }
    </script>

</body>

</html>
